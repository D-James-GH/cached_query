"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[404],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=a.createContext({}),l=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),m=i,h=p["".concat(u,".").concat(m)]||p[m]||d[m]||r;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},8993:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(7462),i=(n(7294),n(3905));const r={},o="Mutations",s={unversionedId:"docs/guides/mutations",id:"docs/guides/mutations",title:"Mutations",description:"A mutation should be used to update data on the server. By its self a mutation doesn't really do anything. However, it",source:"@site/docs/docs/guides/05-mutations.md",sourceDirName:"docs/guides",slug:"/docs/guides/mutations",permalink:"/docs/guides/mutations",draft:!1,editUrl:"https://github.com/D-James-GH/cached_query/tree/main/docs/docs/docs/guides/05-mutations.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/guides/configuration"},next:{title:"Global Cache",permalink:"/docs/guides/global-cache"}},u={},l=[{value:"Creating a mutation",id:"creating-a-mutation",level:2},{value:"Invalidating Queries",id:"invalidating-queries",level:2},{value:"Re-fetching Queries",id:"re-fetching-queries",level:2},{value:"Mutation Key and Cache",id:"mutation-key-and-cache",level:2},{value:"Mutation stream",id:"mutation-stream",level:3},{value:"Mutation Lifecycle",id:"mutation-lifecycle",level:2}],c={toc:l};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"mutations"},"Mutations"),(0,i.kt)("p",null,"A mutation should be used to update data on the server. By its self a mutation doesn't really do anything. However, it\ncomes with a few useful options for updating previously fetched queries. "),(0,i.kt)("h2",{id:"creating-a-mutation"},"Creating a mutation"),(0,i.kt)("p",null,"A mutation is a small wrapper around a queryFn which is an asynchronous that will update the server. It takes two generic\narguments, the first is the queryFn return type and the second is the argument type that will be passed to the queryFn."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},"final createPostMutation = Mutation<ReturnType, ArgType>(\n  queryFn: (post) => createPost(post),\n);\n")),(0,i.kt)("p",null,"To activate a mutation call the mutate function on the ",(0,i.kt)("inlineCode",{parentName:"p"},"Mutation")," object."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},'final post = PostModel(\n  title: "Post title",\n);\nawait createPostMutation.mutate(post);\n')),(0,i.kt)("p",null,"The mutate function takes a single argument which must be the ",(0,i.kt)("inlineCode",{parentName:"p"},"ArgType")," specified when instantiating the mutation. This\nargument will be passed to the queryFn. The mutate function returns a future that completes then the queryFn completes,\nso this can be awaited if you need."),(0,i.kt)("h2",{id:"invalidating-queries"},"Invalidating Queries"),(0,i.kt)("p",null,"It is often a good idea to invalidate all queries that the mutation will affect. To easily do this pass a list of query\nkeys when instantiating the mutation. If the mutation is successful all the queries matching the keys will be invalidated.\nInvalidating a query will not guarantee an immediate re-fetch, it will just mark the query as stale so that next time\nthe query is requested it will be re-fetched. If you know that a query should be re-fetched immediately then use the\n",(0,i.kt)("a",{parentName:"p",href:"#re-fetching-queries"},"refetchQueries")," prop instead.  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},"final createPostMutation = Mutation<PostModel, PostModel>(\n  invalidateQueries: ['posts'],\n  queryFn: (post) => createPost(post),\n);\n")),(0,i.kt)("h2",{id:"re-fetching-queries"},"Re-fetching Queries"),(0,i.kt)("p",null,"To re-fetch a set of queries after a mutation completes pass a list of keys to the ",(0,i.kt)("inlineCode",{parentName:"p"},"refetchQueries")," prop. This will loop\nthrough the keys are force a re-fetch on each query."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},"final createPostMutation = Mutation<PostModel, PostModel>(\n  refetchQueries: ['posts'],\n  queryFn: (post) => createPost(post),\n);\n")),(0,i.kt)("h2",{id:"mutation-key-and-cache"},"Mutation Key and Cache"),(0,i.kt)("p",null,"Unlike a query the mutation key is optional. A mutation will not be cached unless it is given a key. Caching a mutation\nis useful if the current state of the mutation is needed in multiple places. For example, you could have a loading spinner\nin the app bar while the mutation is called in a form submit button. In this case you would use a key to refer to the\nsame mutation."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},'final createPostMutation = Mutation<PostModel, PostModel>(\n  key: "post mutation",\n  queryFn: (post) => createPost(post),\n);\n')),(0,i.kt)("h3",{id:"mutation-stream"},"Mutation stream"),(0,i.kt)("p",null,"Just like a query a mutation has a stream which emits the ",(0,i.kt)("inlineCode",{parentName:"p"},"MutationState")," whenever it changes. There is no ",(0,i.kt)("inlineCode",{parentName:"p"},"cacheDuration"),"\non a mutation so whenever the last listener is removed from a mutation it is immediately removed from memory."),(0,i.kt)("h2",{id:"mutation-lifecycle"},"Mutation Lifecycle"),(0,i.kt)("p",null,"There are three lifecycle call backs for a mutation. "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"onStartMutation"),"  is called before the queryFn. This can be used for ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/optimistic-updates"},"optimistic updates"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"onSuccess")," is called after the queryFn if the mutation is successful."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"onError")," is called after the queryFn if the mutation fails.")))}d.isMDXComponent=!0}}]);