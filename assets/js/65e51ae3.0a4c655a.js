"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[134],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),h=i,m=p["".concat(s,".").concat(h)]||p[h]||c[h]||a;return n?r.createElement(m,o(o({ref:t},d),{},{components:n})):r.createElement(m,o({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var u=2;u<a;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2698:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var r=n(7462),i=(n(7294),n(3905));const a={},o="Simple Query Example",l={unversionedId:"examples/simple-query",id:"examples/simple-query",title:"Simple Query Example",description:"For this example we will walk through the simplest form of caching with Cached Query.",source:"@site/docs/examples/01-simple-query.md",sourceDirName:"examples",slug:"/examples/simple-query",permalink:"/examples/simple-query",draft:!1,editUrl:"https://github.com/D-James-GH/cached_query/tree/main/docs/docs/examples/01-simple-query.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"examples",previous:{title:"Overview",permalink:"/examples/overview"},next:{title:"Flutter Bloc",permalink:"/examples/with-flutter-bloc"}},s={},u=[{value:"The Setup",id:"the-setup",level:2},{value:"Creating the Query",id:"creating-the-query",level:2},{value:"Post Model",id:"post-model",level:3},{value:"The UI",id:"the-ui",level:2},{value:"Post Widget",id:"post-widget",level:3}],d={toc:u};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"simple-query-example"},"Simple Query Example"),(0,i.kt)("p",null,"For this example we will walk through the simplest form of caching with Cached Query."),(0,i.kt)("p",null,"We will use the ",(0,i.kt)("a",{parentName:"p",href:"https://jsonplaceholder.typicode.com/"},"Json Placeholder Api")," with a time delay to demonstrate\ncached data."),(0,i.kt)("p",null,"The source code for this example can be found here: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/D-James-GH/cached_query/tree/main/examples/simple_caching"},"https://github.com/D-James-GH/cached_query/tree/main/examples/simple_caching")),(0,i.kt)("h2",{id:"the-setup"},"The Setup"),(0,i.kt)("p",null,"Install the package."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"flutter pub add cached_query_flutter\n")),(0,i.kt)("p",null,"The setup is optional but to take full advantage of cached query we need to call the config function as early as possible."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," function lets cached query know that it should re-fetch queries if the connectivity is established and if\nthe app comes back into view."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},"void main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  CachedQuery.instance.configFlutter(\n    refetchOnResume: true,\n    refetchOnConnection: true,\n  );\n  runApp(const MyApp());\n}\n")),(0,i.kt)("p",null,"The main app will just consist of one page.  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},"class MyApp extends StatelessWidget {\n  const MyApp({Key? key}) : super(key: key);\n  // This widget is the root of your application.\n  @override\n  Widget build(BuildContext context) {\n    return const MaterialApp(\n      title: 'Flutter Demo',\n      home: PostPage(),\n    );\n  }\n}\n")),(0,i.kt)("h2",{id:"creating-the-query"},"Creating the Query"),(0,i.kt)("p",null,"We create a service function which returns a ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," for us to display. The ",(0,i.kt)("inlineCode",{parentName:"p"},"queryFn")," is where the logic for the request\nneeds to go. This function will be first called when a listener is added to the query stream. "),(0,i.kt)("p",null,"As the app is going to fetch a post by an id we have to add the id to the query key as well. The helper function below\nreturns a key which includes the post id. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},'String postKey(int id) => "postKey$id";\n')),(0,i.kt)("p",null,"Each time the query key changes a new query will be created. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},"\nQuery<PostModel> getPostById(int id) {\n  return Query<PostModel>(\n    key: postKey(id),\n    queryFn: () async {\n      final uri = Uri.parse(\n        'https://jsonplaceholder.typicode.com/posts/$id',\n      );\n      final res = await http.get(uri);\n      return Future.delayed(\n        const Duration(milliseconds: 500),\n        () => PostModel.fromJson(\n          jsonDecode(res.body) as Map<String, dynamic>,\n        ),\n      );\n    },\n  );\n}\n")),(0,i.kt)("h3",{id:"post-model"},"Post Model"),(0,i.kt)("p",null,"This post model is a simple object that we serialize the json payload into."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},'class PostModel {\n  final String title;\n  final int id;\n  final String body;\n  final int userId;\n\n  PostModel({\n    required this.title,\n    required this.id,\n    required this.body,\n    required this.userId,\n  });\n\n  factory PostModel.fromJson(Map<String, dynamic> json) => PostModel(\n    title: json["title"],\n    body: json["body"],\n    id: json["id"],\n    userId: json["userId"],\n  );\n}\n')),(0,i.kt)("h2",{id:"the-ui"},"The UI"),(0,i.kt)("p",null,"The UI will consist of one page. This page will keep the current post id in local state and then increment or decrement\nthe post id if the user chooses."),(0,i.kt)("p",null,"We are passing the ",(0,i.kt)("inlineCode",{parentName:"p"},"QueryBuilder")," the query created above. The builder will call the builder function whenever a new\n",(0,i.kt)("inlineCode",{parentName:"p"},"QueryState")," is emitted."),(0,i.kt)("p",null,"Two query builders are being used, one in the app bar to display the loading and one in the body to display the post. Given\nthe same ",(0,i.kt)("strong",{parentName:"p"},"id")," ",(0,i.kt)("inlineCode",{parentName:"p"},"getPostById")," will always return the same instance of ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," and therefore there is no need to store the\nquery in a variable. We can just use ",(0,i.kt)("inlineCode",{parentName:"p"},"getPostById")," in multiple places."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},'class PostPage extends StatefulWidget {\n  const PostPage({Key? key}) : super(key: key);\n\n  @override\n  State<PostPage> createState() => _PostPageState();\n}\n\nclass _PostPageState extends State<PostPage> {\n  int currentId = 50;\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        centerTitle: true,\n        title: QueryBuilder(\n          query: service.getPostById(currentId),\n          builder: (context, state) {\n            return Text(\n              state.status == QueryStatus.loading ? "loading..." : "",\n            );\n          },\n        ),\n        actions: [\n          IconButton(\n            icon: const Icon(Icons.refresh),\n            onPressed: _refreshPost,\n          )\n        ],\n      ),\n      body: Center(\n        child: Column(\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.center,\n              children: [\n                IconButton(\n                  onPressed: () => setState(() => currentId = currentId - 1),\n                  icon: const Icon(Icons.arrow_left),\n                ),\n                Text(currentId.toString()),\n                IconButton(\n                  onPressed: () => setState(() => currentId = currentId + 1),\n                  icon: const Icon(Icons.arrow_right),\n                ),\n              ],\n            ),\n            Post(id: currentId),\n          ],\n        ),\n      ),\n    );\n  }\n\n  void _refreshPost() {\n    service.getPostById(currentId).refetch();\n  }\n}\n')),(0,i.kt)("h3",{id:"post-widget"},"Post Widget"),(0,i.kt)("p",null,"The Post widget is just responsible for displaying the post with a given id."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dart"},'class Post extends StatelessWidget {\n  final int id;\n\n  const Post({required this.id, super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return QueryBuilder<PostModel>(\n      // Can use key if the query already exists.\n      queryKey: service.postKey(id),\n      builder: (context, state) {\n        final data = state.data;\n        if (state.error != null) return Text(state.error.toString());\n        if (data == null) return const SizedBox();\n        return Container(\n          margin: const EdgeInsets.all(10),\n          child: Column(\n            children: [\n              const Text(\n                "Title",\n                textAlign: TextAlign.center,\n                style: TextStyle(fontSize: 20),\n              ),\n              Text(\n                data.title,\n                textAlign: TextAlign.center,\n              ),\n              const Text(\n                "Body",\n                textAlign: TextAlign.center,\n                style: TextStyle(fontSize: 20),\n              ),\n              Text(\n                data.body,\n                textAlign: TextAlign.center,\n              ),\n            ],\n          ),\n        );\n      },\n    );\n  }\n}\n')))}c.isMDXComponent=!0}}]);