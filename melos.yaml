name: cached_query
repository: https://github.com/D-James-GH/cached_query

packages:
  - packages/**
  - examples/**

ide:
  intellij: false

command:
  bootstrap:
    # It seems so that running "pub get" in parallel has some issues (like
    # https://github.com/dart-lang/pub/issues/3404). Disabling this feature
    # makes the CI much more stable.
    runPubGetInParallel: false
    usePubspecOverrides: true
  version:
    # Generate commit links in package changelogs.
    linkToCommits: true
    # Only allow versioning to happen on main branch.
    branch: main
    # Additionally build a changelog at the root of the workspace.
    workspaceChangelog: true

scripts:
  lint:all:
    run: melos run analyze && melos run format
    description: Run all static analysis checks.
  analyze:
    run: |
      melos exec -c 10 -- \
        flutter analyze --fatal-infos
    description: Run `flutter analyze` for all packages.
  format:
    run: melos exec dart format . --fix
    description: Run `dart format` for all packages.
  get:examples: "find ./examples/ -maxdepth 1 -mindepth 1 -type d -exec flutter pub get {} \\;"
  gen:
    run: flutter pub run build_runner build --delete-conflicting-outputs
    exec:
      concurrency: 1
    select-package:
      depends-on: build_runner
    description: Build all generated files for Flutter packages in this project.
  test:
    run: |
      melos exec -c 6 --fail-fast -- \
        "flutter test --no-pub"
    description: Run `flutter test` for a specific package.
    select-package:
      dir-exists:
        - test
      ignore:
        - "examples/**"
